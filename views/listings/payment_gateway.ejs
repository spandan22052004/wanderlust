<% layout("./layouts/boilerplate") %>

<style>
    /* Ensure the video background covers the entire screen */
    .video-background {
        position: fixed; /* Fixes the video to the viewport */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover; /* Ensures the video covers the entire area */
        z-index: -1; /* Sends the video behind other content */
    }

    /* Container for the payment content */
    .payment-page {
        position: relative; /* Establish a positioning context */
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh; /* Full height of the viewport */
    }

    /* Styling for the payment container */
    .payment-container {
        background: rgba(255, 255, 255, 0.85); /* Slight transparency */
        border-radius: 15px;
        padding: 30px 40px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 400px;
        animation: fadeIn 1s ease-in-out;
    }

    .payment-container h3 {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 20px;
        color: #444;
    }

    .btn-pay {
        background-color: #F37254;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
    }

    .btn-pay:hover {
        background-color: #d3544f;
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(243, 114, 84, 0.3);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @media (max-width: 600px) {
        .payment-container {
            width: 90%;
            padding: 20px;
        }

        .payment-container h3 {
            font-size: 20px;
        }

        .btn-pay {
            width: 100%;
            padding: 14px;
        }
    }
</style>

<body>
    <!-- Full-Screen Video Background -->
    <video class="video-background" autoplay muted loop>
        <source src="/image/background.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- Payment Page Wrapper -->
    <div class="payment-page">
        <!-- Payment Container -->
        <div class="payment-container">
            <h3>Complete Your Payment</h3>
            <button id="rzp-button" class="btn-pay">Pay Now</button>
        </div>
    </div>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        const options = {
            key: "<%= process.env.RAZORPAY_KEY_ID %>",
            amount: "<%= booking.totalPrice * 100 %>", // Amount in paise
            currency: "INR",
            name: "Wanderlust",
            description: "Booking Payment",
            image: "/image/logo.png",
            order_id: "<%= order_id %>", // Order ID from backend
            handler: function (response) {
                fetch(`/verify_payment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        razorpay_order_id: response.razorpay_order_id,
                        razorpay_payment_id: response.razorpay_payment_id,
                        razorpay_signature: response.razorpay_signature,
                    }),
                })
                .then((res) => {
                    if (res.ok) {
                        window.location.href = `/confirmation/<%= booking._id %>`;
                    } else {
                        alert("Payment Verification Failed!");
                    }
                })
                .catch((err) => console.error("Error:", err));
            },
            prefill: {
                name: "<%= booking.name %>",
                email: "<%= booking.email %>",
            },
            theme: { color: "#F37254" },
        };
    
        const rzp = new Razorpay(options);
    
        // Use querySelector to select the button and add event listener
        document.querySelector('.btn-pay').addEventListener('click', function (e) {
            e.preventDefault();
            rzp.open();
        });
    </script>

    <!-- Your Navbar and Footer code should remain here -->
</body>
